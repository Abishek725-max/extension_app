import { useEffect, useState } from "react";
import { Dialog, DialogBackdrop, DialogPanel } from "@headlessui/react";
import { XMarkIcon } from "@heroicons/react/24/outline";
import { Image } from "@nextui-org/react";
import Logo from "../../../assets/images/logo.png";
import whiteLogo from "../../../assets/images/white-logo.png";

import { useTheme } from "next-themes";
import { usePathname } from "next/navigation";
import Link from "next/link";

import { ConnectButton } from "@rainbow-me/rainbowkit";
import { ThemeSwitcher } from "../../themeSwiter/themeSwiter";
import CreateDataNetButton from "../../../components/CreateDataNetButton";
import useWindowUtils from "../../../utils/useWindowUtils";

export default function Header() {
  const [open, setOpen] = useState(false);
  const { resolvedTheme } = useTheme();
  const pathname = usePathname();
  const [logoSrc, setLogoSrc] = useState(Logo); // Set the default logo for SSR

  useEffect(() => {
    // Update the logo source based on the theme after the component mounts
    if (resolvedTheme === "dark") {
      setLogoSrc(whiteLogo);
    } else {
      setLogoSrc(Logo);
    }
  }, [resolvedTheme]);

  const { screenWidth } = useWindowUtils();

  return (
    <>
      {/* Mobile menu */}
      <Dialog open={open} onClose={setOpen} className="relative z-40 lg:hidden">
        <DialogBackdrop
          transition
          className="fixed inset-0 bg-black bg-opacity-25 transition-opacity duration-300 ease-linear data-[closed]:opacity-0"
        />

        <div className="fixed inset-0 z-40 flex">
          <DialogPanel
            transition
            className="relative flex w-full max-w-xs transform flex-col overflow-y-auto bg-white pb-12 shadow-xl transition duration-300 ease-in-out data-[closed]:-translate-x-full"
          >
            <div className="flex px-4 pb-2 pt-5">
              <button
                type="button"
                onClick={() => setOpen(false)}
                className="relative -m-2 inline-flex items-center justify-center rounded-md p-2 text-gray-400"
              >
                <span className="absolute -inset-0.5" />
                <span className="sr-only">Close menu</span>
                <XMarkIcon aria-hidden="true" className="h-6 w-6" />
              </button>
            </div>
          </DialogPanel>
        </div>
      </Dialog>

      <header className="relative bg-white dark:bg-[#0D0D0D]">
        <nav aria-label="Top" className="px-4 sm:px-6 lg:px-8 py-3">
          <div className="inner-header">
            <div className="flex items-center">
              {/* Logo */}
              <div className="ml-4 flex lg:ml-0">
                <Link href="/">
                  <Image
                    alt="logo"
                    src={logoSrc.src}
                    className="h-auto w-[6.5rem] xxl:w-[6rem]"
                  />
                </Link>
              </div>
              {screenWidth > 766 && <CreateDataNetButton />}
              <div className="ml-auto flex items-center">
                <div className="items-center gap-2.5 p-1 bg-[#F9F9F9] dark:bg-[#161618] border border-[#E7E7E9] dark:border-[#2E2E30] rounded-lg hidden xl:flex">
                  <Link
                    href="/"
                    className={`flex justify-center items-center gap-1 rounded-md px-[0.75rem] py-[0.3rem] text-base font-[400] w-auto ${
                      pathname === "/"
                        ? "bg-[#356FF5] text-white"
                        : "bg-transparent text-[#82838A] dark:text-[#71717A]"
                    }`}
                  >
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      className="w-6 h-6"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M19.5 3H4.5C4.10218 3 3.72064 3.15804 3.43934 3.43934C3.15804 3.72064 3 4.10218 3 4.5V19.5C3 19.8978 3.15804 20.2794 3.43934 20.5607C3.72064 20.842 4.10218 21 4.5 21H19.5C19.8978 21 20.2794 20.842 20.5607 20.5607C20.842 20.2794 21 19.8978 21 19.5V4.5C21 4.10218 20.842 3.72064 20.5607 3.43934C20.2794 3.15804 19.8978 3 19.5 3ZM19.5 11.25H12.75V4.5H19.5V11.25ZM11.25 4.5V11.25H4.5V4.5H11.25ZM4.5 12.75H11.25V19.5H4.5V12.75ZM19.5 19.5H12.75V12.75H19.5V19.5Z"
                        className={`${
                          pathname === "/"
                            ? "fill-white"
                            : "fill-[#82838A] dark:fill-[#71717A]"
                        } `}
                      />
                    </svg>
                    Dashboard
                  </Link>
                  {/* <Link
                    href="/leaderboard"
                    className={`flex justify-center items-center gap-1 rounded-md px-[0.75rem] py-[0.3rem] text-base font-[400] w-auto ${
                      pathname === "/leaderboard"
                        ? "bg-[#356FF5] text-white"
                        : "bg-transparent text-[#82838A] dark:text-[#71717A]"
                    }`}
                  >
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      className="w-6 h-6"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M17.25 3.75H6.75C5.35807 3.75149 4.02358 4.30509 3.03933 5.28933C2.05509 6.27358 1.50149 7.60807 1.5 9V18C1.5 18.3978 1.65804 18.7794 1.93934 19.0607C2.22064 19.342 2.60218 19.5 3 19.5H21C21.3978 19.5 21.7794 19.342 22.0607 19.0607C22.342 18.7794 22.5 18.3978 22.5 18V9C22.4985 7.60807 21.9449 6.27358 20.9607 5.28933C19.9764 4.30509 18.6419 3.75149 17.25 3.75ZM21 9V9.75H18V5.325C18.8465 5.49904 19.607 5.95959 20.1535 6.62903C20.7 7.29846 20.9989 8.13584 21 9ZM12.75 12.75H11.25V9.75H12.75V12.75ZM10.5 14.25H13.5C13.6989 14.25 13.8897 14.171 14.0303 14.0303C14.171 13.8897 14.25 13.6989 14.25 13.5V11.25H16.5V18H7.5V11.25H9.75V13.5C9.75 13.6989 9.82902 13.8897 9.96967 14.0303C10.1103 14.171 10.3011 14.25 10.5 14.25ZM14.25 9.75V9C14.25 8.80109 14.171 8.61032 14.0303 8.46967C13.8897 8.32902 13.6989 8.25 13.5 8.25H10.5C10.3011 8.25 10.1103 8.32902 9.96967 8.46967C9.82902 8.61032 9.75 8.80109 9.75 9V9.75H7.5V5.25H16.5V9.75H14.25ZM6 5.325V9.75H3V9C3.00106 8.13584 3.30002 7.29846 3.8465 6.62903C4.39297 5.95959 5.15354 5.49904 6 5.325ZM3 11.25H6V18H3V11.25ZM21 18H18V11.25H21V18Z"
                        fill="#82838A"
                        className={`${
                          pathname === "/leaderboard"
                            ? "fill-white"
                            : "fill-[#82838A] dark:fill-[#71717A]"
                        }`}
                      />
                    </svg>
                    Leaderboard
                  </Link> */}
                  <Link
                    href="/datanets"
                    className={`flex justify-center items-center gap-1 rounded-md px-[0.75rem] py-[0.3rem] text-base font-[400] w-auto ${
                      pathname === "/datanets"
                        ? "bg-[#356FF5] text-white"
                        : "bg-transparent text-[#82838A] dark:text-[#71717A]"
                    }`}
                  >
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      className="w-6 h-6"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M9.75 3.75H5.25C4.85218 3.75 4.47064 3.90804 4.18934 4.18934C3.90804 4.47064 3.75 4.85218 3.75 5.25V9.75C3.75 10.1478 3.90804 10.5294 4.18934 10.8107C4.47064 11.092 4.85218 11.25 5.25 11.25H9.75C10.1478 11.25 10.5294 11.092 10.8107 10.8107C11.092 10.5294 11.25 10.1478 11.25 9.75V5.25C11.25 4.85218 11.092 4.47064 10.8107 4.18934C10.5294 3.90804 10.1478 3.75 9.75 3.75ZM9.75 9.75H5.25V5.25H9.75V9.75ZM18.75 3.75H14.25C13.8522 3.75 13.4706 3.90804 13.1893 4.18934C12.908 4.47064 12.75 4.85218 12.75 5.25V9.75C12.75 10.1478 12.908 10.5294 13.1893 10.8107C13.4706 11.092 13.8522 11.25 14.25 11.25H18.75C19.1478 11.25 19.5294 11.092 19.8107 10.8107C20.092 10.5294 20.25 10.1478 20.25 9.75V5.25C20.25 4.85218 20.092 4.47064 19.8107 4.18934C19.5294 3.90804 19.1478 3.75 18.75 3.75ZM18.75 9.75H14.25V5.25H18.75V9.75ZM9.75 12.75H5.25C4.85218 12.75 4.47064 12.908 4.18934 13.1893C3.90804 13.4706 3.75 13.8522 3.75 14.25V18.75C3.75 19.1478 3.90804 19.5294 4.18934 19.8107C4.47064 20.092 4.85218 20.25 5.25 20.25H9.75C10.1478 20.25 10.5294 20.092 10.8107 19.8107C11.092 19.5294 11.25 19.1478 11.25 18.75V14.25C11.25 13.8522 11.092 13.4706 10.8107 13.1893C10.5294 12.908 10.1478 12.75 9.75 12.75ZM9.75 18.75H5.25V14.25H9.75V18.75ZM18.75 12.75H14.25C13.8522 12.75 13.4706 12.908 13.1893 13.1893C12.908 13.4706 12.75 13.8522 12.75 14.25V18.75C12.75 19.1478 12.908 19.5294 13.1893 19.8107C13.4706 20.092 13.8522 20.25 14.25 20.25H18.75C19.1478 20.25 19.5294 20.092 19.8107 19.8107C20.092 19.5294 20.25 19.1478 20.25 18.75V14.25C20.25 13.8522 20.092 13.4706 19.8107 13.1893C19.5294 12.908 19.1478 12.75 18.75 12.75ZM18.75 18.75H14.25V14.25H18.75V18.75Z"
                        fill="#82838A"
                        className={`${
                          pathname === "/datanets"
                            ? "fill-white"
                            : "fill-[#82838A] dark:fill-[#71717A]"
                        }`}
                      />
                    </svg>
                    DataNets
                  </Link>
                  <Link
                    href="/worker"
                    className={`flex justify-center items-center gap-1 rounded-md px-[0.75rem] py-[0.3rem] text-base font-[400] w-auto ${
                      pathname === "/worker"
                        ? "bg-[#356FF5] text-white"
                        : "bg-transparent text-[#82838A] dark:text-[#71717A]"
                    }`}
                  >
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      className="w-6 h-6"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M21.75 9C21.7504 8.93027 21.7409 8.86083 21.7219 8.79375L20.3766 4.0875C20.2861 3.77523 20.0971 3.50059 19.8378 3.30459C19.5784 3.10858 19.2626 3.00174 18.9375 3H5.0625C4.73741 3.00174 4.4216 3.10858 4.16223 3.30459C3.90287 3.50059 3.71386 3.77523 3.62344 4.0875L2.27906 8.79375C2.2597 8.86079 2.24991 8.93022 2.25 9V10.5C2.25 11.0822 2.38554 11.6563 2.6459 12.1771C2.90625 12.6978 3.28427 13.1507 3.75 13.5V20.25C3.75 20.4489 3.82902 20.6397 3.96967 20.7803C4.11032 20.921 4.30109 21 4.5 21H19.5C19.6989 21 19.8897 20.921 20.0303 20.7803C20.171 20.6397 20.25 20.4489 20.25 20.25V13.5C20.7157 13.1507 21.0937 12.6978 21.3541 12.1771C21.6145 11.6563 21.75 11.0822 21.75 10.5V9ZM5.0625 4.5H18.9375L20.0081 8.25H3.99469L5.0625 4.5ZM9.75 9.75H14.25V10.5C14.25 11.0967 14.0129 11.669 13.591 12.091C13.169 12.5129 12.5967 12.75 12 12.75C11.4033 12.75 10.831 12.5129 10.409 12.091C9.98705 11.669 9.75 11.0967 9.75 10.5V9.75ZM8.25 9.75V10.5C8.24987 10.8869 8.14996 11.2673 7.95993 11.6043C7.7699 11.9413 7.49617 12.2236 7.16518 12.424C6.83419 12.6244 6.45713 12.736 6.07041 12.7481C5.68369 12.7602 5.30038 12.6724 4.9575 12.4931C4.90533 12.4525 4.84794 12.4191 4.78688 12.3937C4.46913 12.1903 4.20764 11.9103 4.02646 11.5794C3.84527 11.2484 3.7502 10.8773 3.75 10.5V9.75H8.25ZM18.75 19.5H5.25V14.175C5.4969 14.2248 5.74813 14.2499 6 14.25C6.58217 14.25 7.15634 14.1145 7.67705 13.8541C8.19776 13.5937 8.6507 13.2157 9 12.75C9.3493 13.2157 9.80224 13.5937 10.323 13.8541C10.8437 14.1145 11.4178 14.25 12 14.25C12.5822 14.25 13.1563 14.1145 13.6771 13.8541C14.1978 13.5937 14.6507 13.2157 15 12.75C15.3493 13.2157 15.8022 13.5937 16.3229 13.8541C16.8437 14.1145 17.4178 14.25 18 14.25C18.2519 14.2499 18.5031 14.2248 18.75 14.175V19.5ZM19.2122 12.3937C19.1519 12.4191 19.0952 12.4522 19.0434 12.4922C18.7006 12.6716 18.3173 12.7596 17.9305 12.7477C17.5437 12.7357 17.1666 12.6242 16.8355 12.424C16.5044 12.2237 16.2305 11.9414 16.0404 11.6044C15.8502 11.2673 15.7502 10.887 15.75 10.5V9.75H20.25V10.5C20.2497 10.8774 20.1545 11.2486 19.9731 11.5795C19.7918 11.9104 19.5301 12.1904 19.2122 12.3937Z"
                        fill="#82838A"
                        className={`${
                          pathname === "/worker"
                            ? "fill-white"
                            : "fill-[#82838A] dark:fill-[#71717A]"
                        }`}
                      />
                    </svg>
                    Worker
                  </Link>
                </div>

                <button
                  type="button"
                  className={`flex justify-center items-center gap-4 rounded-md px-[0.75rem] py-[0.5rem] text-base font-[400] border border-[#E7E7E9] dark:border-[#2E2E30] bg-[#F9F9F9] dark:bg-[#161618] text-[#82838A] dark:text-white md:ml-4 lg:ml-6`}
                >
                  {/* <svg
                    width="25"
                    height="24"
                    viewBox="0 0 25 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    className="w-6 h-6 fill-[#82838A] dark:fill-[#71717A]"
                  >
                    <path
                      d="M12.3721 7.49998C11.4821 7.49998 10.6121 7.7639 9.87206 8.25837C9.13204 8.75284 8.55526 9.45564 8.21467 10.2779C7.87407 11.1002 7.78496 12.005 7.95859 12.8779C8.13223 13.7508 8.56081 14.5526 9.19015 15.182C9.81948 15.8113 10.6213 16.2399 11.4942 16.4135C12.3671 16.5871 13.2719 16.498 14.0942 16.1574C14.9165 15.8168 15.6193 15.2401 16.1137 14.5C16.6082 13.76 16.8721 12.89 16.8721 12C16.8709 10.8069 16.3964 9.66302 15.5527 8.81937C14.7091 7.97573 13.5652 7.50122 12.3721 7.49998ZM12.3721 15C11.7788 15 11.1988 14.824 10.7054 14.4944C10.2121 14.1647 9.82755 13.6962 9.60049 13.148C9.37342 12.5999 9.31401 11.9967 9.42977 11.4147C9.54553 10.8328 9.83125 10.2982 10.2508 9.87866C10.6704 9.4591 11.2049 9.17338 11.7869 9.05763C12.3688 8.94187 12.972 9.00128 13.5202 9.22834C14.0684 9.45541 14.5369 9.83992 14.8665 10.3333C15.1962 10.8266 15.3721 11.4066 15.3721 12C15.3721 12.7956 15.0561 13.5587 14.4934 14.1213C13.9308 14.6839 13.1678 15 12.3721 15ZM22.679 10.0509C22.6581 9.9453 22.6147 9.84543 22.5518 9.75807C22.4889 9.67072 22.4079 9.59793 22.3143 9.54467L19.5178 7.95092L19.5065 4.79904C19.5062 4.69049 19.4823 4.58331 19.4365 4.4849C19.3907 4.38649 19.324 4.29919 19.2412 4.22904C18.2267 3.37095 17.0585 2.71336 15.7987 2.29123C15.6995 2.25765 15.5943 2.24522 15.49 2.25475C15.3857 2.26428 15.2846 2.29555 15.1931 2.34654L12.3721 3.92342L9.54838 2.34373C9.45683 2.29245 9.35555 2.26094 9.25106 2.25125C9.14658 2.24156 9.04123 2.2539 8.94181 2.28748C7.68272 2.71232 6.51579 3.37246 5.50306 4.23279C5.42035 4.30284 5.35379 4.38999 5.30799 4.48823C5.26219 4.58647 5.23823 4.69347 5.23775 4.80186L5.22369 7.95654L2.42713 9.55029C2.33357 9.60356 2.25257 9.67634 2.18964 9.7637C2.12671 9.85105 2.08333 9.95093 2.06244 10.0565C1.8065 11.3427 1.8065 12.6667 2.06244 13.9528C2.08333 14.0584 2.12671 14.1583 2.18964 14.2456C2.25257 14.333 2.33357 14.4058 2.42713 14.459L5.22369 16.0528L5.23494 19.2056C5.23528 19.3142 5.25918 19.4213 5.30498 19.5197C5.35079 19.6182 5.41741 19.7055 5.50025 19.7756C6.51469 20.6337 7.6829 21.2913 8.94275 21.7134C9.04197 21.747 9.14711 21.7594 9.25142 21.7499C9.35573 21.7404 9.45689 21.7091 9.54838 21.6581L12.3721 20.0765L15.1959 21.6562C15.3076 21.7185 15.4336 21.7508 15.5615 21.75C15.6434 21.75 15.7248 21.7367 15.8024 21.7106C17.0612 21.286 18.2281 20.6265 19.2412 19.7672C19.3239 19.6971 19.3905 19.61 19.4363 19.5117C19.4821 19.4135 19.506 19.3065 19.5065 19.1981L19.5206 16.0434L22.3171 14.4497C22.4107 14.3964 22.4917 14.3236 22.5546 14.2363C22.6175 14.1489 22.6609 14.049 22.6818 13.9434C22.9363 12.6583 22.9354 11.3357 22.679 10.0509ZM21.2728 13.3237L18.5943 14.8472C18.477 14.9139 18.3798 15.0111 18.3131 15.1284C18.2587 15.2222 18.2015 15.3215 18.1434 15.4153C18.069 15.5335 18.0293 15.6703 18.029 15.81L18.0149 18.8334C17.295 19.3988 16.4929 19.8509 15.6365 20.174L12.9346 18.6684C12.8225 18.6064 12.6963 18.5741 12.5681 18.5747H12.5503C12.4368 18.5747 12.3224 18.5747 12.209 18.5747C12.0748 18.5714 11.9422 18.6038 11.8246 18.6684L9.12088 20.1778C8.26261 19.8571 7.45834 19.4072 6.73588 18.8437L6.72556 15.825C6.7251 15.685 6.68548 15.548 6.61119 15.4294C6.55306 15.3356 6.49588 15.2419 6.44244 15.1425C6.37618 15.0233 6.27902 14.9242 6.16119 14.8556L3.47994 13.3284C3.34119 12.4507 3.34119 11.5567 3.47994 10.679L6.15369 9.15279C6.27104 9.08606 6.36821 8.9889 6.43494 8.87154C6.48931 8.77779 6.5465 8.67842 6.60463 8.58467C6.67903 8.46644 6.71867 8.32967 6.719 8.18998L6.73306 5.16654C7.453 4.60118 8.25506 4.14909 9.1115 3.82592L11.8096 5.33154C11.9271 5.39663 12.0598 5.42901 12.194 5.42529C12.3074 5.42529 12.4218 5.42529 12.5353 5.42529C12.6695 5.42901 12.8022 5.39663 12.9196 5.33154L15.6234 3.82217C16.4816 4.14286 17.2859 4.59274 18.0084 5.15623L18.0187 8.17498C18.0192 8.31495 18.0588 8.45199 18.1331 8.57061C18.1912 8.66436 18.2484 8.75811 18.3018 8.85748C18.3681 8.97665 18.4652 9.07575 18.5831 9.14436L21.2643 10.6715C21.4049 11.5499 21.4065 12.4449 21.269 13.3237H21.2728Z"
                      fill="#71717A"
                    />
                  </svg> */}
                  <ThemeSwitcher />
                </button>
                <div className="md:ml-4 lg:ml-6 ml-2">
                  <ConnectButton accountStatus="avatar" label="Connect" />
                </div>
              </div>
            </div>
          </div>
        </nav>
      </header>
    </>
  );
}
